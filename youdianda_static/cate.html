<!DOCTYPE html>
<html class="x-admin-sm">

<head>
  <meta charset="UTF-8">
  <title></title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
  <link rel="stylesheet" href="./css/font.css">
  <link rel="stylesheet" href="./css/xadmin.css">
  <script src="./lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="./js/xadmin.js"></script>
  <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="x-nav">
    <span class="layui-breadcrumb">
      <a href="">首页</a>
      <a href="">演示</a>
      <a>
        <cite>导航元素</cite></a>
    </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
      onclick="location.reload()" title="刷新">
      <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
  </div>
  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <!-- 提交表单 -->



      <form class="layui-form " action="">
        <div class="layui-form-item">
          <label class="layui-form-label">分类名</label>
          <div class="layui-input-block">
            <input type="text" name="catename" required lay-verify="required" placeholder="请输入分类名" autocomplete="off"
              class="layui-input" style="width: 200px;">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">分类总数</label>
          <div class="layui-input-inline">
            <input type="password" name="sort_num" required lay-verify="required" placeholder="请输入分类总数"
              autocomplete="off" class="layui-input" style="width: 200px;">
          </div>

        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">icon</label>
          <div class="layui-input-block">
            <input type="text" name="icon" required lay-verify="required" placeholder="请输入图标" autocomplete="off"
              class="layui-input" style="width: 200px;">
          </div>
        </div>
        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn" lay-filter="formDemo">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
          </div>
        </div>
      </form>



      <table class="layui-table">
        <colgroup>
          <col width="150">
          <col width="200">
          <col>
        </colgroup>
        <thead>
          <tr>
            <th>id</th>
            <th>名称</th>
            <th>icon</th>
            <th>分类总数</th>

            <th>修改</th>
            <th>删除</th>
          </tr>
        </thead>
        <tbody class="tbody">
          <!-- <tr>
            <td>贤心</td>
            <td>2016-11-29</td>
            <td>人生就像是一场修行</td>
          </tr> -->

        </tbody>
      </table>


    </div>
  </div>

</body>
<script src="./js/axios.js"></script>
<script src="./js/common.js"></script>
<script src="./js/form-serialize.js"></script>
<script>
  const myForm = document.querySelector('form')
  const tbody = document.querySelector('.tbody')
  // 1.封装渲染函数
  function render() {
    axios({
      url: '/ydd_cate/all',
    }).then((res) => {
      console.log(res)
      tbody.innerHTML = res.data.map(e => `
    <tr>
        <td>${e.id}</td>
        <td>${e.catename}</td>
        <td>${e.icon}</td>
        <td>${e.sort_num}</td>
        <td><button class="layui-btn " data-id=${e.id}>修改</button></td>
        <td><button id="del" class="layui-btn  layui-btn-danger" data-id=${e.id}>删除</button></td>
        
          </tr>
    `).join('')

    })
  }


  render()
  // 表单


  // 2.添加模块
  const form = document.querySelector('form')
  form.addEventListener('submit', e => {
    e.preventDefault()
    console.log('我中文');
    const data = serialize(form, { hash: true, empty: true })
    data.sort_num = +data.sort_num
    axios({
      url: '/ydd_cate/add',
      method: 'post',
      data: data,
    }).then((result) => {
      console.log(result);
      render()
      form.reset()
    })

  })

  // 删除模块
  // 事件委托

  tbody.addEventListener('click', e => {
    if (e.target.classList.contains('layui-btn-danger')) {
      const id = e.target.dataset.id
      console.log('我要删除');
      axios({
        url: '/ydd_cate/del',
        params: {
          id
        }
      }).then(res => {
        console.log(res);
        render()
      }).catch((err) => {

      });

    }

  })







</script>

</html>